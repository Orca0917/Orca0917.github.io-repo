---
title:  "μ¤μ°¨μ—­μ „ν (Back Propagation)"
excerpt: "μ‹ κ²½λ§μ΄ ν•™μµν•  μ μλ” λ°©λ²•μΈ μ¤μ°¨μ—­μ „νλ²•μ κ°λ…κ³Ό μ›λ¦¬ κ·Έλ¦¬κ³  μ „μ²΄μ μΈ λ™μ‘κ³Όμ •μ„ μ‚΄ν΄λ΄…λ‹λ‹¤."

categories:
  - DLBasic
tags:
  - [AI, Naver, BoostCamp, Math]
toc: true
toc_sticky: true
 
date: 2022-02-07 05:00:00
last_modified_at: 2022-06-18 00:00:00
---

![image](https://user-images.githubusercontent.com/91870042/174443439-4691d9dc-c430-4318-9166-fdea3ac702c1.png){: .align-center width="100%"}

<br>

# μ¤μ°¨μ—­μ „ν

νΌμ…‰νΈλ΅ μ κ°λ…λ¶€ν„° μ‹μ‘ν•΄μ„ μ‹ κ²½λ§μ κµ¬μ΅° κ·Έλ¦¬κ³  μ—¬κΈ°μ— ν•„μ”ν• ν™μ„±ν•¨μμ™€ μ‹ κ²½λ§μ„ ν‰κ°€ν•λ” μ†μ‹¤ν•¨μμ— λ€ν•΄μ„ μ•μ•„λ³΄μ•μµλ‹λ‹¤. μ΄μ  μ†μ‹¤ν•¨μλ΅ κµ¬ν• μ¤μ°¨μ™€ λ”¥λ¬λ‹ ν•™μµλ°©λ²•λ΅ μΈ κ²½μ‚¬ν•κ°•λ²•μ„ κ²°ν•©ν•μ—¬ μ‹ κ²½λ§μ„ ν•™μµν•λ” `μ¤μ°¨μ—­μ „ν(backpropagation)` μ— λ€ν•΄μ„ μ‚΄ν΄λ΄…μ‹λ‹¤!

## π§ μμ „ν

μ¤μ°¨ μ—­μ „νμ μ—­μ „νλ” μμ „νλ¥Ό κ±°κΎΈλ΅ ν• κ²ƒμ„ μλ―Έν•©λ‹λ‹¤. κ·Έλ ‡λ‹¤λ©΄ μ‹ κ²½λ§μ—μ„ μμ „νλ” λ¬΄μ—‡μ„ μλ―Έν•λ” κ²ƒμΌκΉμ”? μμ „νλ” νΌμ…‰νΈλ΅  ν¬μ¤ν…μ—μ„ μ–ΈκΈ‰μ„ ν•μ§€λ” μ•μ•μ§€λ§ μ΄λ―Έ λ‹¤λ¤λ μ μ΄ μμµλ‹λ‹¤.

![image](https://user-images.githubusercontent.com/91870042/174476268-e42ab307-7d64-4329-9a63-6ff9e7aa5adc.png){: .align-center width="60%"}

$$
\begin{aligned}
  \mathbf{z} &= \mathbf{W}^{(1)}\mathbf{x} + \mathbf{b}^{(1)}\\
  \mathbf{h} &= \sigma (\mathbf{z})\\
  \mathbf{o} &= \mathbf{W}^{(2)}\mathbf{h} + \mathbf{b}^{(2)}\\
\end{aligned}
$$

- $\mathbf{W}^{(k)}$ : $k$ λ²μ§Έ λ μ΄μ–΄μ κ°€μ¤‘μΉ ν–‰λ ¬
- $\mathbf{b}^{(k)}$ : $k$ λ²μ§Έ λ μ΄μ–΄μ νΈν–¥ (bias)

κ·Έλ¦Όμ—μ„ λΉ¨κ°„μƒ‰ μ„ μΌλ΅ μ§„ν–‰λλ” κ³Όμ •μ΄ `μμ „ν`λΌκ³  ν•  μ μμµλ‹λ‹¤. μ…λ ¥κ°’μ— λ€ν•΄ νλΌλ―Έν„°μΈ κ°€μ¤‘μΉ $\mathbf{W}^{(1)}, \mathbf{W}^{(2)}$ κ°€ κ³±ν•΄μ§€κ³ , ν™μ„±ν•¨μλ¥Ό κ±°μ³ μ¶λ ¥μΌλ΅ λ³΄λ‚΄λ” κ³Όμ •μ΄ μμ „νμ…λ‹λ‹¤. μ†μ‹¤ν•¨μλ” μ΄ μ¶λ ¥κ°’μ„ μ‚¬μ©ν•μ—¬ μ¤μ°¨λ¥Ό κ³„μ‚°ν•©λ‹λ‹¤.

## π§« μ—­μ „ν

μ—­μ „νλ” μμ „νμ λ°λ€μ…λ‹λ‹¤. κ±°κΎΈλ΅ κ³„μ‚°λ μ¤μ°¨λ¥Ό μ¶λ ¥μΈµ, ν™μ„±ν•¨μμΈµ, μμΌλ΅ κ±°μ³μ„ κ° νλΌλ―Έν„°λ“¤κ³Ό κ³±ν•΄μ§€λ” μ—°μ‚°κ³Όμ •λ„ κ±°κΎΈλ΅ κ±°μ³κ°‘λ‹λ‹¤. μ΄ κ³Όμ •μ—μ„ κ° νλΌλ―Έν„°λ” μ •λ‹µμ„ μ λ§μ¶”λ„λ΅ ν•™μµμ΄ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.

μ΄μ „ κ²μ‹κΈ€μ—μ„ μ†μ‹¤ν•¨μμ κ°’μ΄ μ¤„μ–΄λ“λ” λ°©ν–¥μΌλ΅ νλΌλ―Έν„°λ¥Ό μ—…λ°μ΄νΈ ν•΄λ‚κ°€λ” κ²½μ‚¬ν•κ°•λ²•μ— λ€ν•΄μ„ μ•μ•„λ³΄μ•μ—μµλ‹λ‹¤. κ²½μ‚¬ν•κ°•λ²•μ€ μ†μ‹¤ν•¨μλ¥Ό μ—…λ°μ΄νΈ ν•κ³ μν•λ” νλΌλ―Έν„°μ— λ€ν•΄μ„ λ―Έλ¶„ν•μ—¬ κ·Έ κΈ°μΈκΈ°λ¥Ό λ”°λΌμ„ λ‚΄λ ¤κ°€λ” λ°©λ²•λ΅ μ„ λ§ν•©λ‹λ‹¤. λ”°λΌμ„ μ‹ κ²½λ§μ—μ„λ„ κ²½μ‚¬ν•κ°•λ²•μ μ›λ¦¬λ¥Ό μ μ©μ‹μΌ λ―Έλ¶„μ„ μ§„ν–‰ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, 1λ²μ§Έ μΈµμ νλΌλ―Έν„°μ— λ€ν•΄ λ―Έλ¶„μ„ ν•λ” κ³Όμ •μ€ μ•„λμ™€ κ°™μ΄ λ‚νƒ€λ‚Ό μ μμµλ‹λ‹¤.

$$
\frac{\partial \text{Loss}}{\partial \mathbf{W^{(1)}}}
$$

- $\text{Loss}$ : μ†μ‹¤ν•¨μ

μ¤μ°¨μ—­μ „νλ” λ‹¨μν μ΄ νΈλ―Έλ¶„μ„ μ‚¬μ©ν•μ§€ μ•κ³ , ν•©μ„±ν•¨μ λ―Έλ¶„λ²•μΈ `μ—°μ‡„λ²•μΉ™(Chain Rule)`κΈ°λ°μ μλ™λ―Έλ¶„μ„ μ‚¬μ©ν•©λ‹λ‹¤. μΌλ‹¨ λ¨Όμ € κ°„λ‹¨ν• μμ‹λ¥Ό λ“¤μ–΄μ„ μ΄ν•΄λ¥Ό ν•΄λ΄…μ‹λ‹¤!

$$
z=(x+y)^2
$$

μ„μ μ‹μ„ $x$μ— λ€ν•΄μ„ νΈλ―Έλ¶„ν•λ” κ³Όμ •μ„ λ―Έλ¶„μ μ—°μ‡„λ²•μΉ™μ„ μ‚¬μ©ν•μ—¬ λ‚νƒ€λ‚΄λ©΄ μ•„λμ™€ κ°™μµλ‹λ‹¤.

$$
t = x+y\\
z = t^2\\
\frac{\partial z}{\partial x} = \frac{\partial z}{\partial w} \frac{\partial w}{\partial x} = 2w \times 1 = 2(x+y)
$$

μ΄ μμ μ™€ λ§μ°¬κ°€μ§€λ΅, λ―Έλ¶„ μ—°μ‡„λ²•μΉ™μ„ μ‚¬μ©ν•λ©΄ μµμΆ… μ¤λ¥μ— λ€ν• 1λ²μ§Έ λ μ΄μ–΄μ κ°€μ¤‘μΉν–‰λ ¬μ λ―Έλ¶„μ‹μ€ μ•„λμ²λΌ ν’€μ–΄μ„ λ‚νƒ€λ‚Ό μ μμµλ‹λ‹¤.

$$
\nabla_{\mathbf{W^{(1)}}}\mathcal{L} = (\nabla_{\mathbf{W^{(1)}}}\mathbf{z})(\nabla_\mathbf{z}\mathbf{h})(\nabla_\mathbf{h}\mathbf{O})(\nabla_\mathbf{O}\mathcal{L})
$$

$$
\frac{\partial\mathcal{L}}{\partial\mathbf{W}^{(1)}} = \frac{\partial\mathcal{L}}{\partial\mathbf{O}}\frac{\partial\mathbf{O}}{\partial\mathbf{h}}\frac{\partial\mathbf{h}}{\partial\mathbf{z}}\frac{\partial\mathbf{z}}{\partial\mathbf{W}^{(1)}}
$$

- $\mathcal{L}$ : μ†μ‹¤ν•¨μ (loss function)



μ¤μ°¨μ—­μ „νλ” μ΄λ° μ—°μ‡„λ²•μΉ™μ„ μ‚¬μ©ν•μ—¬ κ° νλΌλ―Έν„°μ— μ•λ§μ€ μ¤μ°¨λ¥Ό μ „λ‹¬ν•λ” κ²ƒμ΄ κ°€λ¥ν•λ©°, Pythonμ λ”¥λ¬λ‹ ν”„λ μ„μ›ν¬ μ¤‘ ν•λ‚μΈ PyTorchμ—μ„λ” μ΄ μ¤μ°¨μ—­μ „ν κ³Όμ •μ„ κ³„μ‚°κ·Έλν”„λ΅ ν‘ν„ν•μ—¬ `μλ™λ―Έλ¶„`μ μ„±μ§μ„ κ·Έλ€λ΅ κ°€μ Έκ°”μµλ‹λ‹¤. μ¤μ°¨μ—­μ „νμ— λ λ‹¤λ¥Έ μ„±μ§λ΅λ” κ° νλΌλ―Έν„°μ— λ§λ” μ¤μ°¨κ°’μ„ κ°€μ Έκ°„λ‹¤λ” κ²ƒμ…λ‹λ‹¤. λ” λ§μ΄ μ λ» μμΈ΅ν• νλΌλ―Έν„°μ— λ€ν•΄μ„λ” λ” ν¬κ² μμ •μ„ ν•λ„λ΅ ν•λ©°, μ΄λ―Έ μ μ„¤μ •λμ–΄ μλ” νλΌλ―Έν„°λ” λ μμ •μ΄ λλ„λ΅ λ§λ“¤μ–΄μ¤λ‹λ‹¤.

