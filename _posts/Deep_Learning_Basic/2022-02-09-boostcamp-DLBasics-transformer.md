---
title:  "[Deep Learning Basic] Transformer"
excerpt: "Transformerì— ëŒ€í•œ ì„¤ëª…"

categories:
  - DLBasic
tags:
  - [AI, Naver, BoostCamp, Python, Math]
toc: true
toc_sticky: true

date: 2022-02-14 01:00:00
last_modified_at: 2022-02-09 01:00:00
---
ğŸ“Œ **ì•Œë¦½ë‹ˆë‹¤!**<br>
ì´ë²ˆì— ì‘ì„±ë˜ëŠ” ê¸€ì€ **ë„¤ì´ë²„ ë¶€ìŠ¤íŠ¸ìº í”„ AI Tech**ë¥¼ ìˆ˜ê°•í•˜ë©° ì •ë¦¬í•˜ëŠ” ê¸€ì…ë‹ˆë‹¤.<br>
ì—¬ê¸°ì„œ ì¡´ì¬í•˜ëŠ” ê°•ì˜ ìë£Œì˜ ì¶œì²˜ëŠ” ë„¤ì´ë²„ ë¶€ìŠ¤íŠ¸ì½”ìŠ¤/ìº í”„ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
{: .notice--info}

# Sequential Model

- Sequential Modelingì´ ë‹¤ë£¨ê¸° ì–´ë ¤ìš´ ë¬¸ì œì¸ ì´ìœ 
    - ë¬¸ì¥ì˜ ë§ˆì§€ë§‰ ë‹¨ì–´ê°€ ìƒëµ / Trimmed sequence
    - ë¬¸ì¥ì˜ ì¤‘ê°„ì— ë‹¨ì–´ê°€ ìƒëµ / Omitted sequence
    - ë¬¸ì¥ì˜ ì–´ìˆœì´ ë’¤ì£½ë°•ì£½ / Permuted sequence
- RNNì€ ì…ë ¥ì´ ìˆœì°¨ì ìœ¼ë¡œ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì—, ì´ëŸ° sequential dataì— ëŒ€í•´ì„œ ëª¨ë¸ë§í•˜ê¸° í˜ë“¤ë‹¤.  
â†’ ì´ê²ƒì„ í•´ê²°í•˜ê³ ì í–ˆë˜ê²Œ Transformer
    
<br>

# Transformer

- Attenion is All You Need, NIPS, 2017

![image](https://user-images.githubusercontent.com/91870042/153738991-96971592-0f21-4803-8d31-1dca8c1a3527.png){: .align-center width="70%"}

- RNNê³¼ ë‹¬ë¦¬ ì¬ê·€ì ì¸ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , self-attention êµ¬ì¡°ì˜ ì‚¬ìš©
- ëª¨ë¸ì˜ ìì„¸í•œ ë¶€ë¶„ì„ ìƒëµí•˜ê³ , ê¸°ê³„ë²ˆì—­ì„ Transformerë¡œ ì‚¬ìš©í•˜ë©´ ë°‘ì˜ ê·¸ë¦¼ì²˜ëŸ¼ ë‚˜íƒ€ë‚œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153738995-5935719b-ae4d-466c-8229-820a96d6d4ac.png){: .align-center width="70%"}

- ìì„¸íˆ ë“¤ì—¬ë‹¤ë³´ê¸° ìœ„í•´ì„œ Transformerì˜ êµ¬ì¡°ë¥¼ ì‚´ì§ ë“¤ì—¬ë‹¤ë³´ë©´ í¬ê²Œ Encoderì™€ Decoderë¡œ ë‚˜ë‰œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739000-7cd6de4e-d508-41db-b50d-30062e0da2a1.png){: .align-center width="70%"}

- ì—¬ê¸°ì„œ ì¡°ê¸ˆ ë” ë“¤ì–´ê°€ë©´, Encoders Blockì€ ì—¬ëŸ¬ê°œì˜ encoderë¥¼ ìŒ“ì•„ì˜¬ë ¤ì„œ ë§Œë“  êµ¬ì¡°ì´ë‹¤. ì´ ë…¼ë¬¸ì— ì†Œê°œí•  ëŒ€ëŠ” 6ê°œì˜ encoderì™€ decoderë¥¼ ìŒ“ì•˜ë‹¤. í•˜ì§€ë§Œ 6ê°œë§ê³  ì–¸ì œë“ ì§€ ì›í•˜ëŠ” ë§Œí¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739007-c3791b89-b76a-4198-871c-ccd77f60962b.png){: .align-center width="70%"}

- í•˜ë‚˜ì˜ ë¬¸ì¥ì´ ì…ë ¥ìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ 6ê°œì˜ encoderë¥¼ ê±°ì¹˜ê³ , ë‹¤ì‹œ decoderë¥¼ ê±°ì³ì„œ outputë¥¼ ë‚¸ë‹¤. encoderì™€ decoderì— ëŒ€í•´ì„œ ë” ìì„¸í•˜ê²Œ ì•Œê¸° ìœ„í•´ì„œ ë¨¼ì €, encoderì˜ ë‚´ë¶€ë¥¼ ëœ¯ì–´ë³´ë©´ ë‹¤ì‹œ, `Self-Attention` ê³¼ `Feed Forward Neural Network` ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739011-3d8da40c-81c8-4216-b88d-c38c61a43c9a.png){: .align-center width="70%"}

- ì¸ì½”ë”ë¡œ ë“¤ì–´ì˜¨ ì…ë ¥ì€ ë¨¼ì € self-attetion layerì„ ê±°ì³ì„œ feed forward nn layerë¡œ ë“¤ì–´ê°€ëŠ” êµ¬ì¡°ë¥¼ ê°–ê³  ìˆë‹¤.
- self attetion layerì— ëŒ€í•´ì„œ ë” ìì„¸íˆ ë‹¤ë£¨ê¸° ì•ì„œì„œ, ì–´ë–¤ ë¬¸ì¥ì— ëŒ€í•œ ì…ë ¥ì„ ê¸°ê³„ê°€ ê³„ì‚°í•˜ê¸° ì‰½ê²Œ í•˜ë„ë¡ ì„ë² ë”©ì„ ì‚¬ìš©í•´ ë²¡í„°ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì„ í•´ì•¼í•œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739020-c81efb7f-3fe0-4dcf-843d-32f18d9ab339.png){: .align-center width="70%"}

- ì´ ì„ë² ë”©ëœ ê° ë‹¨ì–´ë“¤ì„ self-attention layerì— ì „ë‹¬ë˜ê²Œ ëœë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739025-80d02a8a-bf7f-4db9-896d-bca71b4e36d4.png){: .align-center width="70%"}

- self-Attention layerì— ì „ë‹¬ëœ ê° ë‹¨ì–´ì˜ ë²¡í„° $$x$$ ëŠ” ë ˆì´ì–´ë¥¼ ê±°ì¹œ ë²¡í„° $$z$$ ë¡œ ë°”ë€ŒëŠ”ë° ì¼ë°˜ì ìœ¼ë¡œ ì‹ ê²½ë§ì€ í•˜ë‚˜ì˜ ë²¡í„°ì— ëŒ€í•´ì„œ ì—¬ëŸ¬ê°€ì§€ ì—°ì‚°ì„ ê±°ì¹œí›„ ê²°ê³¼ë¥¼ ë‚¸ë‹¤.
- í•˜ì§€ë§Œ, Self-Attention layerì—ì„œëŠ” í•˜ë‚˜ì˜ ë‹¨ì–´ë²¡í„°ê°€ ì…ë ¥ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ ë‚˜ë¨¸ì§€ ë‹¨ì–´ë²¡í„°ì— ëŒ€í•´ì„œë„ ê°™ì´ ê³ ë ¤í•´ì„œ ê²°ê³¼ë¥¼ ë‚¸ë‹¤.
- ê·¸ì™€ ë°˜ëŒ€ë¡œ, Feed Forward NNì—ì„œëŠ” ë…ë¦½ì ì´ê³  ë³‘ë ¬ì ìœ¼ë¡œ ì—°ì‚°ì´ ì§„í–‰ëœë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739035-83f8fce5-876b-4f03-81da-ec50396385c6.png){: .align-center width="70%"}

---

- ì˜ˆë¥¼ ë“¤ì–´, ì´ë²ˆì—ëŠ” ì…ë ¥ìœ¼ë¡œ 2ê°œì˜ ë‹¨ì–´ Thinking ê³¼ Machinesê°€ ì£¼ì–´ì¡Œê³ , ì´ë¥¼ ë²¡í„°ë¡œ ë³€í™˜ê¹Œì§€ ë˜ì—ˆë‹¤ê³  í•˜ì. ê·¸ëŸ¬ë©´ í•˜ë‚˜ì˜ encoder ë‚´ì—ì„œ 2ê°œì˜ layerì— ì˜í•´ ì—°ì‚°ì´ ë˜ê³  ê²°ê³¼ë¥¼ ë±‰ì–´ë‚¸ë‹¤. ì´ ê²°ê³¼ë¬¼ì€ ë‹¤ì‹œ ë‹¤ìŒ encoderì˜ ì…ë ¥ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739042-46f5045d-f5c1-4d41-834e-bc58f9438d16.png){: .align-center width="70%"}

---

- Self Attention layerì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ í•˜ë‚˜ì˜ ì˜ˆë¡œ ì‚´í´ë³´ì.
    
    > *The animal didnâ€™t cross the street because **it** was too tired*
    > 
    
    ìœ„ì˜ ë¬¸ì¥ì—ì„œ it ì´ ê°€ë¦¬í‚¤ëŠ”ê²ƒì´ ë¬´ì—‡ì¸ì§€ ì–´ë–¤ ê²ƒê³¼ ì—°ê²°ì´ ë˜ëŠ”ì§€ ë°”ë¡œ self-attention layerì—ì„œ ê³„ì‚°í•œë‹¤. ë‹¤ì‹œë§í•´, itì´ ë‹¤ë¥¸ ë‹¨ì–´ë“¤ê³¼ ì–¼ë§Œí¼ì˜ ì—°ê´€ì„±ì„ ê°–ê³  ìˆëŠ”ì§€ ê³„ì‚°í•´ì¤€ë‹¤.
    

![image](https://user-images.githubusercontent.com/91870042/153739050-613f3e4b-593e-4e5a-87b3-3ee68be7056f.png){: .align-center width="70%"}

- ë‹¤ì‹œ ëŒì•„ì™€ì„œ, self-attentionì„ ë” ìì„¸íˆ ë“¤ì—¬ë‹¤ ë³´ë©´, ì…ë ¥ ë²¡í„°ë¡œë¶€í„° 3ê°œì˜ ë˜ë‹¤ë¥¸ ë²¡í„°ë¥¼ ë§Œë“¤ì–´ë‚´ê²Œ ëœë‹¤. ì´ ê°ê°ì˜ ë²¡í„°ë¥¼ Query ë²¡í„°, Key ë²¡í„°, Value ë²¡í„°ë¼ê³  í•œë‹¤.
- ì´ 3ê°œì˜ ë²¡í„°ê°€ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì€, ë˜ ë‹¤ë¥¸ ê°ê°ì˜ layerì— ëŒ€í•´ì„œ 3ê°œì˜ ë…ë¦½ì ì¸ í•™ìŠµ ê°€ëŠ¥í•œ í–‰ë ¬ë“¤ì„ ê°ê° ê³±í•´ì„œ ë§Œë“ ë‹¤.
- ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì§„ ë²¡í„°ëŠ” ê¸°ì¡´ì˜ ë²¡í„°ë“¤ë³´ë‹¤ ë” ì‘ì€ ì‚¬ì´ì¦ˆë¥¼ ê°–ëŠ” ê²ƒì´ì¢‹ë‹¤. ë°˜ë“œì‹œ ì‘ì•„ì•¼ í•œë‹¤ëŠ” ê²ƒì€ ì•„ë‹ˆì§€ë§Œ, ì¤„ì´ê²Œ ë˜ë©´ multi-head attentionì˜ ê³„ì‚°ë³µì¡ë„ë¥¼ ì¼ì •í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739056-446af061-9d2c-47f9-a29d-b6f6dd9f25ce.png){: .align-center width="70%"}

- $$x_1$$ë²¡í„°ì— ëŒ€í•´ì„œ í•™ìŠµê°€ëŠ¥í•œ ì¿¼ë¦¬í–‰ë ¬ $$W^Q$$ë¥¼ ê³±í•´ì„œ ì¿¼ë¦¬ë²¡í„° $$q_1$$ì„ ì–»ì–´ë‚¸ë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ ë‹¤ë¥¸ ì…ë ¥ë²¡í„°, ë‹¤ë¥¸ key, valueë²¡í„°ì— ëŒ€í•´ì„œë„ ë™ì¼í•˜ê²Œ ì§„í–‰í•œë‹¤.
- ê·¸ëŸ¬ë©´ ì´ì œ ì´ 3ê°œì˜ ë²¡í„°ê°€ ê°–ëŠ” ì˜ë¯¸ì— ëŒ€í•´ì„œ ì•Œì•„ë´ì•¼í•œë‹¤. ì´ëŠ” attentionë‚´ì—ì„œ ìƒê°ê³¼ ê³„ì‚°í•  ë•Œ ë„ì›€ì´ ë˜ëŠ” ì¶”ìƒì ì¸ ê°œë…ì´ê³ , attentionì´ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ê³„ì‚°ë˜ëŠ”ì§€ ì•Œë©´ ìì—°ìŠ¤ëŸ½ê²Œ  ì—­í• ì„ ì•Œ ìˆ˜ ìˆê²Œ ëœë‹¤.
- self-attention layer ë‚´ì—ì„œ 3ê°€ì§€ ë²¡í„°ë¥¼ ì¤€ë¹„í•˜ê³  ë‚œ ë‹¤ìŒ ë‹¨ê³„ëŠ”, ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” ê²ƒì´ë‹¤. ì´ ì ìˆ˜ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì…ë ¥ì— ëŒ€í•´ì„œ ì–¼ë§ˆë‚˜ ìœ ì‚¬ë„ ë˜ëŠ” ì—°ê´€ì„±ì„ ê°–ê³  ìˆëŠ”ì§€ë¥¼ ë§í•œë‹¤.
- ì ìˆ˜ê°€ ê³„ì‚°ë˜ëŠ” ë°©ì‹ì€ í˜„ì¬ ë‹¨ì–´ì˜ ì¿¼ë¦¬ ë²¡í„° $$q_1$$ê³¼ ì ìˆ˜ë¥¼ ë§¤ê¸°ë ¤ê³  í•˜ëŠ” ë‹¤ë¥¸ ë‹¨ì–´ì˜ í‚¤ ë²¡í„° $$k_2$$ì— ëŒ€í•´ì„œ ë‚´ì ìœ¼ë¡œ ê³„ì‚°í•œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739061-94299c6c-49da-4bce-8192-62f77c114465.png){: .align-center width="70%"}

- í•˜ë‚˜ì˜ ë‹¨ì–´ì— ëŒ€í•´ì„œ ë‹¤ë¥¸ ë‹¨ì–´ì™€ì˜ ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ì˜€ë‹¤ë©´, ì´ì œ ì´ ì ìˆ˜ë¥¼ keyë²¡í„°ì˜ í¬ê¸°ì˜ ì œê³±ê·¼ìœ¼ë¡œ ë‚˜ëˆˆë‹¤. ì¢€ë” ìˆ˜ì‹ì ìœ¼ë¡œ í‘œí˜„í•˜ë©´, $$d_k$$ë¥¼ keyë²¡í„°ì˜ í¬ê¸°ë¼ê³  í–ˆì„ ë•Œ, $$\sqrt{d_k}$$ë¡œ ë‚˜ëˆˆë‹¤.
- ë‚˜ëˆ„ê³  ë‚œ ê°’ì„ ì´ë²ˆì—ëŠ” í™•ë¥ ë¡ ì  í•´ì„ì„ í•˜ê¸° ìœ„í•´ì„œ softmaxë¥¼ í†µê³¼ì‹œì¼œ ì´ í•©ì„ 1ì´ ë  ìˆ˜ ìˆê²Œë” ë§Œë“¤ì–´ì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739067-b4d24d6f-0151-429c-b645-5e5bc7000d45.png){: .align-center width="70%"}

$$
\text{softmax} = \frac{e^{z_j}}{\sum_{k=1}^{K}e^{z_k}}\quad \text{for j = 1, \dots, K}
$$

- ê·¸ ë‹¤ìŒ ë‹¨ê³„ëŠ” ì´ì œ ê° ë‹¨ì–´ë“¤ì˜ value ë²¡í„°ì— ì´ ì ìˆ˜ë¥¼ ê³±í•˜ëŠ” ê²ƒì´ë‹¤. ì´ë ‡ê²Œ ê³±í•˜ëŠ” ê²ƒì€ ìš°ë¦¬ê°€ ì§‘ì¤‘í•˜ê³  ì‹¶ì€ ë‹¨ì–´ëŠ” ë‚¨ê¸°ê³ , ê´€ë ¨ì´ ì—†ëŠ” ë‹¨ì–´ë“¤ì€ ë¬´ì‹œí•˜ê¸° ìœ„í•´ì„œì´ë‹¤.
- ê³±í•´ì§€ê³  ë‚œ ë²¡í„°ë“¤ì— ëŒ€í•´ì„œ ëª¨ë‘ ë§ì…ˆì„ í•´ì£¼ë©´, ìµœì¢…ì ìœ¼ë¡œ attention layerì˜ í•˜ë‚˜ì˜ ë‹¨ì–´ì— ëŒ€í•œ ì¶œë ¥ì´ ì™„ì„±ëœë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739072-bdcf15c2-8ed7-43ca-9110-620ec5678f7f.png){: .align-center width="70%"}

- ì§€ê¸ˆê¹Œì§€ í•˜ë‚˜ì˜ ë‹¨ì–´ì— ëŒ€í•´ì„œ ì—°ì‚°ê³¼ì •ì„ ì‚´í´ë´¤ë‹¤ë©´, ì´ë²ˆì—ëŠ” í–‰ë ¬ì— ëŒ€í•´ì„œ ê³„ì‚°ì„ ì•Œì•„ë´ì•¼í•œë‹¤.
- ê°€ì¥ ì²«ë²ˆì§¸ ë‹¨ê³„ëŠ” ì§€ê¸ˆê¹Œì§€ í–ˆë˜ê²ƒê³¼ ë™ì¼í•˜ê²Œ ì…ë ¥í–‰ë ¬ì— ëŒ€í•´ì„œ key, value, query í–‰ë ¬ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ê²ƒì´ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739080-fad7e1fc-ddb9-4d7c-a04b-9c4ee6a0ba5c.png){: .align-center width="70%"}

- ìœ„ì˜ ê·¸ë¦¼ì—ì„œ ì…ë ¥í–‰ë ¬ $$X$$ì˜ ê° í–‰ì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ì…ë ¥ ë¬¸ì¥ì˜ ê° ë‹¨ì–´ì— í•´ë‹¹ëœë‹¤.
- ìœ„ì—ì„œ ì—°ì‚°í•œ ë‚˜ë¨¸ì§€ ê³¼ì •ë“¤ì„ í•œë²ˆì— ìˆ˜ì‹ê³¼ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739082-904ecdf6-86bc-4996-8bf7-a4bec0dd45b0.png){: .align-center width="70%"}

- ìœ„ì—ì„œ softmaxë¥¼ ê³„ì‚°í•  ë•ŒëŠ” í–‰ë‹¨ìœ„ë¡œ ì—°ì‚°ì„ ì§„í–‰í•œë‹¤.
- ë˜ í•˜ë‚˜ì˜ ì¤‘ìš”í•œ ì ì€ Queryì™€ Keyí–‰ë ¬ì€ ë‚´ì ì„ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œ ë‘ ì°¨ì›ì´ ë™ì¼í•´ì•¼ í•˜ì§€ë§Œ, Value í–‰ë ¬ì€ ê·¸ë ‡ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ê²ƒì´ë‹¤.


## MHA: Multi Headed Attention

- ì´ë²ˆì—ëŠ” ìœ„ì—ì„œ ë³¸ self-attention layerì— â€œmulti-headedâ€ êµ¬ì¡°ë¥¼ í¬í•¨ì‹œì¼œì„œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¨ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739086-8ba016d6-a83b-4b4e-85d8-17ae953fe63e.png){: .align-center width="70%"}

- multi headed attentionì€ ë§ê·¸ëŒ€ë¡œ attentionì—°ì‚°ì„ í•˜ë‚˜ì˜ ì…ë ¥ì— ëŒ€í•´ì„œ ì—¬ëŸ¬ë²ˆ ìˆ˜í–‰ì‹œí‚¤ëŠ” ê²ƒì„ ë§í•œë‹¤.
- ì´ë ‡ê²Œ ë˜ë©´, ê° headì— ëŒ€í•´ì„œ query, key, value í–‰ë ¬ì„ ìƒì„±í•˜ê¸° ìœ„í•œ í•™ìŠµê°€ëŠ¥í•œ í–‰ë ¬ì´ í•„ìš”í•˜ë‹¤.
- headê°€ 1ê°œì¸ self-attention êµ¬ì¡°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì—°ì‚°ì„ í•˜ê²Œ ë˜ë©´, ê²°êµ­ì— multi-headed-attentionì€ $$n$$ ê°œì˜ ì„œë¡œë‹¤ë¥¸ $$z$$ í–‰ë ¬ì„ outputìœ¼ë¡œ ì–»ê²Œ ëœë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739091-924e247b-c086-438e-84f2-fb2f02038471.png){: .align-center width="70%"}

- ìœ„ì˜ ê·¸ë¦¼ì²˜ëŸ¼ 8ê°œì˜ headë¥¼ ê°€ì§€ê³  attention ì—°ì‚°ì„ ìˆ˜í–‰í–ˆë‹¤ë©´, ë¬¸ì œëŠ” ì´ 8ê°œì˜ í–‰ë ¬ì„ ë°”ë¡œ feed-forward layerë¡œ ë³´ë‚¼ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤.
- ì™œëƒí•˜ë©´, feed-forward layerëŠ” í•œê°œì˜ ìœ„ì¹˜ì— ëŒ€í•´ ì˜¤ì¹™ í•˜ë‚˜ì˜ í–‰ë ¬ë§Œì„ inputìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì´ 8ê°œì˜ í–‰ë ¬ì„ ê°€ì§€ê³  ì–´ë–»ê²Œë“  1ê°œì˜ í–‰ë ¬ë¡œ ë§Œë“¤ì–´ë‚´ëŠ” ë°©ë²•ì„ ìƒê°í•´ë‚´ì•¼ í•œë‹¤.
- ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ MHAëŠ” ëª¨ë“  í–‰ë ¬ì„ ì´ì–´ë¶™ì´ê³ , ë˜ë‹¤ë¥¸ í–‰ë ¬ê³±ì„ í†µí•´ ê·¸ í¬ê¸°ë¥¼ ë³€í˜•ì‹œí‚¨ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739096-52d3341b-6be9-4921-b8bc-0cb42c4b98a8.png){: .align-center width="70%"}

- ë³€í˜•ëœ outputì„ ê°€ì§€ê³  feed-forward layerë¡œ ë³´ë‚´ë©´ ê·¸ê²Œ MHAì˜ ëì´ë‹¤.
- ë‹¤ì‹œ ì „ì²´ ê³¼ì •ì„ í•œëˆˆì— ì •ë¦¬í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739103-1609d08c-573f-4724-9412-68a07f50b765.png){: .align-center width="70%"}


- ì§€ê¸ˆê¹Œì§€ Attention ì—°ì‚°ì„ ì‚´í´ë³´ì•˜ëŠ”ë°, ì‚¬ì‹¤ í•˜ë‚˜ ê°„ê³¼í•˜ê³  ìˆë˜ ì ì€ ë¬¸ì¥ì—ì„œì˜ ë‹¨ì–´ì˜ ìœ„ì¹˜ (ìˆœì„œ)ì— ëŒ€í•´ì„œ ì „í˜€ ê³ ë ¤í•˜ê³  ìˆì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤.
- ì‹¤ì œë¡œ ì–´ë–¤ ë§ì„ í•˜ê²Œ ë˜ë©´ ê·¸ ë¬¸ì¥ì˜ ìˆœì„œê°€ ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ ë‹¨ì–´ë¥¼ ë²¡í„°ë¡œ ë°”ê¿”ì£¼ëŠ” ì„ë² ë”©ì— `positional encoding` ì´ë¼ëŠ” í•˜ë‚˜ì˜ ë²¡í„°ë¥¼ ì¶”ê°€í•œë‹¤.
- ì´ ë²¡í„°ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œ ì¨, ë‚˜ì¤‘ì— ê° ë‹¨ì–´ì˜ ìœ„ì¹˜ì™€ sequenceë‚´ì—ì„œ ìœ„ì¹˜ ì°¨ì´ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739107-e6f60126-98cb-464e-97ff-2d37816719b6.png){: .align-center width="70%"}

- ë§Œì•½ ìœ„ì˜ ì˜ˆì‹œì²˜ëŸ¼ ì„ë² ë”©ì˜ í¬ê¸°ê°€ 4ë¼ê³  í•œë‹¤ë©´, ì‹¤ì œ ê° ìœ„ì¹˜ì— ë”°ë¥¸ positional encodingì€ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì˜¨ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739110-f7592e22-993a-4922-a6c2-4557db9f2db0.png){: .align-center width="70%"}

- ë‹¤ìŒì€ 512ê°œì˜ ì…€ì„ ê°€ì§„ ë²¡í„°ì´ë©° ê° ì…€ì€ -1 ~ 1 ì‚¬ì´ì˜ ê°’ì„ ê°–ëŠ”ë‹¤. ì—¬ê¸°ì„œ ì²«ë²ˆì§¸ í–‰ì´ ë§í•˜ëŠ” ê²ƒì€ ì²«ë²ˆì§¸ ë‹¨ì–´ì— ëŒ€í•œ positional encodingì— í•´ë‹¹ëœë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739116-8398c114-6b22-4fee-a57c-6a312934756b.png){: .align-center width="70%"}

- ìœ„ì˜ positional encoding ì´ë¯¸ì§€ì—ì„œ ë°˜ìœ¼ë¡œ ë‚˜ë‰œê²ƒ ì²˜ëŸ¼ ë³´ì´ëŠ” ê²ƒì€ ì„œë¡œ ë‹¤ë¥¸ 2ê°€ì§€ í•¨ìˆ˜ì— ì˜í•´ì„œ ìƒì„±ë˜ê³  ì—°ê²°ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.
    - ì™¼ìª½: sin í•¨ìˆ˜
    - ì˜¤ë¥¸ìª½: cos í•¨ìˆ˜
- ìµœê·¼ì˜ positinal encodingì€ ì¡°ê¸ˆ ë°”ë€Œì–´ì„œ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¥¼ ëˆë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739121-39f599ce-8530-4288-a1ba-21812fc9e8d5.png){: .align-center width="70%"}

---

- encoderì— ëŒ€í•œ ì„¤ëª…ì„ ë„˜ì–´ê°€ê¸° ì „ì—, í•˜ë‚˜ ì•Œê³ ê°€ì•¼ í•˜ëŠ” ê²ƒì€ ê° encoder ë‚´ì—ì„œ sublayerê°€ ResNetì—ì„œ ì‚¬ìš©ëœ Residual Connectionìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆê³ , ì´ í›„ì—ëŠ” layer-normalization ê³¼ì •ì„ ê±°ì¹œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739126-f49bcff6-f9ef-4a60-8443-f96964a73f4e.png){: .align-center width="70%"}

- ìœ„ì—ì„œ ë²¡í„°ë“¤ê³¼ì˜ layer normalizationì„ ë” ìì„¸íˆ ë“¤ì—¬ë‹¤ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739131-eb0b08a1-2d3c-4b8b-bf9c-d7857c8003aa.png){: .align-center width="70%"}

- encoderë‚´ì— ìˆëŠ” residual connectionì€ decoderë¶€ë¶„ì—ë„ ë˜‘ê°™ì´ ì ìš©ë˜ì–´ ìˆë‹¤. ë§Œì•½ 2ê°œì˜ encoderì™€ decoderê°€ ìˆëŠ” transformerêµ¬ì¡°ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë˜ì–´ìˆì„ ê²ƒì´ë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739136-0dcbc983-f22b-4896-9e61-fd1ada87f876.png){: .align-center width="70%"}

---

### Decoder êµ¬ì¡°

![image](https://user-images.githubusercontent.com/91870042/153739143-8ab707f2-ef5d-46cb-a135-5af61bdf8531.png){: .align-center width="70%"}

- encoderì˜ ë§ˆì§€ë§‰ì—ì„œ ë‚˜ì˜¨ ì¶œë ¥ì€ ë‹¤ì‹œ 2ê°œì˜ ë²¡í„° $$K, V$$ë¡œ ë³€í˜•ì´ ëœë‹¤. ì´ ë²¡í„°ë“¤ì€ decoderì˜ encoder-decoder attention layerì—ì„œ decoderê°€ ì…ë ¥ ì‹œí€€ìŠ¤ì—ì„œ ì ì ˆí•œ ìœ„ì¹˜ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.

![https://nlpinkorean.github.io/images/transformer/transformer_decoding_1.gif](https://nlpinkorean.github.io/images/transformer/transformer_decoding_1.gif){: .align-center width="70%"}

- decoding ë‹¨ê³„ì—ì„œëŠ” í•˜ë‚˜ì˜ ë²ˆì—­ëœ ë‹¨ì–´ë¥¼ ì¶œë ¥ìœ¼ë¡œ ë±‰ì–´ë‚¸ë‹¤. ì´  ë±‰ì–´ë‚´ëŠ” ê³¼ì •ì€ `EOS` (end of sentence)ê°€ ì¶œë ¥ë  ë•Œ ê¹Œì§€ ë°˜ë³µí•´ì„œ ì§„í–‰ëœë‹¤.
- decoderì—ì„œ ì¶œë ¥ìœ¼ë¡œ ë½‘ì•„ë‚¸ ë‹¨ì–´ëŠ” ë‹¤ì‹œ deocderì˜ ë§¨ ë°‘ì˜ ì…ë ¥ìœ¼ë¡œ ë“¤ì–´ê°€ê²Œ ë˜ê³  ì´ëŠ” encoderì™€ ë™ì¼í•˜ê²Œ ì„ë² ë”©ê³¼ positional encoding ê³¼ì •ì„ ê±°ì³ì„œ ì „ë‹¬ëœë‹¤.

![https://nlpinkorean.github.io/images/transformer/transformer_decoding_2.gif](https://nlpinkorean.github.io/images/transformer/transformer_decoding_2.gif){: .align-center width="70%"}

- ì´ decoder ë‚´ì—ì„œ ì¡´ì¬í•˜ëŠ” self-attention layerëŠ” encoderì˜ self-attention layerì™€ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤.
- decoderì—ì„œëŠ” output sequenceì— ëŒ€í•´ì„œ í˜„ì¬ ìœ„ì¹˜ ì´ì „ì— ìˆëŠ” ê²ƒì— ëŒ€í•´ì„œë§Œ attendë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë‹¤. ì´ ê³¼ì •ì€ ì¼ë°˜ì ì¸ attention ê³„ì‚°ì—ì„œ softmaxë¥¼ ì·¨í•˜ê¸° ì „ì— í˜„ì¬ ìŠ¤í… ì´í›„ì˜ ìœ„ì¹˜ë“¤ì— ëŒ€í•´ì„œ -INFë¡œ ì¹˜í™˜í•´ì£¼ë©´ ëœë‹¤.

- encoder-decoder attention layerì—ì„œëŠ” multi-head self-attentionê³¼ ë‹¨ í•œê°€ì§€ì˜ ì°¨ì´ì ì„ ê°€ì§€ê³  ìˆë‹¤.
- ê·¸ ì°¨ì´ì ì€ Query í–‰ë ¬ì„ ë°‘ì˜ layerì—ì„œ ê°€ì ¸ì˜¤ê³ , keyì™€ valueí–‰ë ¬ë“¤ì„ encoderì˜ ì¶œë ¥ì—ì„œ ê°€ì ¸ì˜¨ë‹¤ëŠ” ì ì´ë‹¤. decoderì—ì„œ ê°€ì¥ ì²˜ìŒì— ë§í•œ ë¶€ë¶„ì´ ì´ê²ƒì´ë‹¤.

- transformerì˜ ê°€ì¥ ë§ë‹¨ì¸ Linearê³¼ softmax layerì—ì„œëŠ” ì†Œìˆ˜ì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ë²¡í„°ë¥¼ í•˜ë‚˜ì˜ ë‹¨ì–´ë¡œ ë°”ê¿”ì£¼ëŠ” ì¼ì„ í•œë‹¤.
- ë¨¼ì €, Linear LayerëŠ” Fully-Connected ì‹ ê²½ë§ìœ¼ë¡œ decoderê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ë±‰ì–´ë‚¸ ë²¡í„°ê°’ì„ í›¨ì”¬ ë” í° í¬ê¸°ì˜ ë²¡í„°ì¸ logits ë²¡í„°ë¡œ íˆ¬ì˜ì‹œí‚¨ë‹¤.
- Softmax Layerì—ì„œëŠ” logits ë²¡í„°ì˜ ê° ì›ì†Œë¥¼ í™•ë¥ ë¡œ í•´ì„í•´ì„œ ê°€ì¥ ë†’ì€ í™•ë¥  ê°’ì„ ê°–ëŠ” ì…€ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë¥¼ ê²°ê³¼ë¬¼ë¡œ ì¶œë ¥í•œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739155-43465b7f-8e62-486c-8036-aed1b00ebd84.png){: .align-center width="70%"}

## ViT: Vision Transformer

- ìµœê·¼ì—ëŠ” ìœ„ì˜ Transformerë¥¼ ì‚¬ìš©í•´ì„œ Computer Vision ë¶„ì•¼ì—ì„œë„ ì‚¬ìš©í•œë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739159-b4c52e7a-f720-4e9d-8cbd-c5672e5c33b7.png){: .align-center width="70%"}

- ë¬¸ì¥ì„ ì£¼ë©´, ê·¸ ë¬¸ì¥ì— ë§ëŠ” ì´ë¯¸ì§€ë¥¼ ê·¸ë ¤ì£¼ëŠ” `DALL-E` ë¼ëŠ” ëª¨ë¸ë„ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/91870042/153739162-2fdf2b26-38d8-4e22-b379-730e13710a58.png){: .align-center width="70%"}

<br>

# References

[ğŸ“˜ The Illustrated Transformer - Jay Alammar](https://jalammar.github.io/illustrated-transformer/)

[ğŸ“˜ íŠ¸ëœìŠ¤í¬ë¨¸(Transformer) - ë”¥ ëŸ¬ë‹ì„ ì´ìš©í•œ ìì—°ì–´ ì²˜ë¦¬ ì…ë¬¸](https://wikidocs.net/31379)